
#--------------------------------------------------------------------------
# INITIAL DISTRIBUTION
#--------------------------------------------------------------------------
setfile("beam", "gpt.particles.gdf"); 
#--------------------------------------------------------------------------


#--------------------------------------------------------------------------
# ACCURACY AND INTEGRATION PARAMETERS
#--------------------------------------------------------------------------
RadiusMax = 0.04;
GBacc =5.5;
xacc  =6.5;
accuracy(GBacc, xacc);
dtmin =1e-16;
dtmax =1e-10;
#--------------------------------------------------------------------------


#--------------------------------------------------------------------------
# Spacecharge Parameters
#--------------------------------------------------------------------------
space_charge = 1;

Alpha  =1;    # 1.0   (manual default is 1.0), (bigger is better)
Fn     =0.5;  # 0.5   (manual default is 0.5), (smaller is better)
verror =0.005;# 0.005 (manual default is 0.01), (smaller is better)
Nstd   =5;    # 5     (manual default is 5), (bigger is better)

if(space_charge==1) {
    spacecharge3Dmesh("MeshNfac", Alpha, "MeshAdapt", Fn, "SolverAcc", verror, "MeshBoxSize", Nstd);
}
#--------------------------------------------------------------------------


#--------------------------------------------------------------------------
# OUTPUT PARAMETERS
#--------------------------------------------------------------------------
auto_phase=0;
Ntout = 50.0;  
tmax = 8e-9;  

ZSTART = -0.5;
ZSTOP = 4.0;
zminmax("wcs", "I", ZSTART, ZSTOP);

tout(0, tmax, tmax/Ntout);

screen("wcs", "I", 3.75);
#--------------------------------------------------------------------------


#--------------------------------------------------------------------------
# FIELD MAPS
#--------------------------------------------------------------------------
GUN01_z = 0.15;
GUN01_scale = 0.8;
Map2D_E("wcs", 0, 0, GUN01_z, 1, 0, 0, 0, 1, 0, "fields/gun_0mm.gdf", "R", "Z", "Er", "Er", GUN01_scale);
SOL01_z = 0.33;
SOL01_scale = 3.5;
Map1D_B("wcs", 0, 0, SOL01_z, 1, 0, 0, 0, 1, 0, "fields/B_FIELD.gdf", "z", "Bz", SOL01_scale);
SOL02_z = 0.95;
SOL02_scale = 2.5;
Map1D_B("wcs", 0, 0, SOL02_z, 1, 0, 0, 0, 1, 0, "fields/B_FIELD.gdf", "z", "Bz", SOL02_scale);
CAV01_z = 1.65;
CAV01_scale = 2.5;
CAV01_oncrest_phase = 0;
CAV01_relative_phase = 0;
CAV01_phase = (CAV01_oncrest_phase + CAV01_relative_phase)*pi/180;
CAV01_gamma = 1;
phasing_amplitude_0 = CAV01_scale;
phasing_on_crest_0  = CAV01_oncrest_phase;
phasing_relative_0  = CAV01_relative_phase;
phasing_gamma_0 = CAV01_gamma;
CAV01_frequency = 197000000.0;
Map1D_TM("wcs", 0, 0, CAV01_z, 1, 0, 0, 0, 1, 0, "fields/197MHz.v1.gdf", "z", "Ez", CAV01_scale, CAV01_phase, 2*pi*CAV01_frequency);
CAV02_z = 2.19;
CAV02_scale = 1.0;
CAV02_oncrest_phase = 0;
CAV02_relative_phase = 0;
CAV02_phase = (CAV02_oncrest_phase + CAV02_relative_phase)*pi/180;
CAV02_gamma = 1;
phasing_amplitude_0 = CAV02_scale;
phasing_on_crest_0  = CAV02_oncrest_phase;
phasing_relative_0  = CAV02_relative_phase;
phasing_gamma_0 = CAV02_gamma;
CAV02_frequency = 197000000.0;
Map1D_TM("wcs", 0, 0, CAV02_z, 1, 0, 0, 0, 1, 0, "fields/197MHz.v1.gdf", "z", "Ez", CAV02_scale, CAV02_phase, 2*pi*CAV02_frequency);
CAV03_z = 2.85;
CAV03_scale = 0.333;
CAV03_oncrest_phase = 0;
CAV03_relative_phase = 0;
CAV03_phase = (CAV03_oncrest_phase + CAV03_relative_phase)*pi/180;
CAV03_gamma = 1;
phasing_amplitude_0 = CAV03_scale;
phasing_on_crest_0  = CAV03_oncrest_phase;
phasing_relative_0  = CAV03_relative_phase;
phasing_gamma_0 = CAV03_gamma;
CAV03_frequency = 591000000.0;
Map1D_TM("wcs", 0, 0, CAV03_z, 1, 0, 0, 0, 1, 0, "fields/591MHz.v1.gdf", "z", "Ez", CAV03_scale, CAV03_phase, 2*pi*CAV03_frequency);
